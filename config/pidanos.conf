# Pidanos Main Configuration File
# ================================
# This is the main configuration file for Pidanos DNS Filter
# Edit this file to customize your Pidanos installation

# General Settings
general:
  # Installation mode: standalone, docker, systemd
  mode: standalone
  
  # Data directory for persistent storage
  data_dir: /var/lib/pidanos
  
  # Log directory
  log_dir: /var/log/pidanos
  
  # Run as daemon
  daemon: true
  
  # PID file location
  pid_file: /var/run/pidanos.pid
  
  # Debug mode (more verbose logging)
  debug: false
  
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_level: INFO

# DNS Server Configuration
dns:
  # Listen addresses (0.0.0.0 for all interfaces)
  listen_addresses:
    - "0.0.0.0"
    - "::"  # IPv6
  
  # DNS port
  port: 53
  
  # Upstream DNS servers (used when not blocked)
  upstream_dns:
    primary:
      - "1.1.1.1"        # Cloudflare
      - "1.0.0.1"        # Cloudflare backup
    secondary:
      - "8.8.8.8"        # Google
      - "8.8.4.4"        # Google backup
    ipv6:
      - "2606:4700:4700::1111"  # Cloudflare IPv6
      - "2606:4700:4700::1001"  # Cloudflare IPv6 backup
  
  # DNS query timeout in seconds
  query_timeout: 5
  
  # Enable DNSSEC validation
  dnssec: true
  
  # EDNS buffer size
  edns_buffer_size: 1232
  
  # Rate limiting
  rate_limiting:
    enabled: true
    queries_per_second: 1000
    burst_size: 2000
  
  # Custom DNS records
  custom_records:
    # example.local: "192.168.1.100"
    # test.local: "::1"

# Blocking Configuration
blocking:
  # Blocking mode
  mode: "null_ip"  # null_ip, nxdomain, custom_ip
  
  # Custom blocking IP (if mode is custom_ip)
  custom_ip: "127.0.0.1"
  custom_ipv6: "::1"
  
  # Block page settings
  block_page:
    enabled: true
    port: 8080
    show_reason: true
  
  # Gravity (blocklist management)
  gravity:
    # Auto-update blocklists
    auto_update: true
    
    # Update interval (seconds)
    update_interval: 86400  # 24 hours
    
    # Update time (24h format)
    update_time: "03:00"
    
    # Concurrent downloads
    concurrent_downloads: 4
    
    # Download timeout (seconds)
    download_timeout: 300

# Cache Configuration  
cache:
  # Enable caching
  enabled: true
  
  # Cache size (number of entries)
  size: 10000
  
  # Default TTL (seconds)
  default_ttl: 300
  
  # Minimum TTL
  min_ttl: 60
  
  # Maximum TTL
  max_ttl: 86400
  
  # Prefetch popular domains
  prefetch:
    enabled: true
    threshold: 10  # queries before prefetch
    
  # Serve stale cache entries
  serve_stale: true
  serve_stale_ttl: 3600

# Web Interface Configuration
web:
  # Enable web interface
  enabled: true
  
  # Web interface address
  host: "0.0.0.0"
  
  # Web interface port
  port: 8080
  
  # Base URL path
  base_path: "/"
  
  # Session timeout (seconds)
  session_timeout: 3600
  
  # HTTPS/TLS settings
  https:
    enabled: false
    cert_file: "/etc/pidanos/certs/cert.pem"
    key_file: "/etc/pidanos/certs/key.pem"
    force_https: true
  
  # CORS settings
  cors:
    enabled: true
    origins:
      - "http://localhost:8080"
      - "https://pidanos.harmonocode.com"

# API Configuration
api:
  # Enable API
  enabled: true
  
  # API endpoint
  endpoint: "/api"
  
  # API key authentication
  auth:
    enabled: true
    method: "token"  # token, basic, oauth2
  
  # Rate limiting
  rate_limit:
    enabled: true
    requests_per_minute: 60
    
  # API documentation
  docs:
    enabled: true
    endpoint: "/api/docs"

# Database Configuration
database:
  # Database type: sqlite, postgresql, mysql
  type: sqlite
  
  # SQLite settings
  sqlite:
    path: "/var/lib/pidanos/pidanos.db"
    journal_mode: "WAL"
    
  # PostgreSQL settings (if type is postgresql)
  postgresql:
    host: "localhost"
    port: 5432
    database: "pidanos"
    username: "pidanos"
    password: "change_me"
    ssl_mode: "prefer"
    
  # Connection pool
  pool:
    size: 10
    max_overflow: 20
    timeout: 30

# Statistics Configuration
statistics:
  # Enable statistics collection
  enabled: true
  
  # Retention period (days)
  retention_days: 7
  
  # Detailed query logging
  query_log:
    enabled: true
    anonymize_clients: false
    
  # Performance metrics
  metrics:
    enabled: true
    export_interval: 60  # seconds

# Security Configuration
security:
  # Authentication settings
  auth:
    # Default admin password (change immediately!)
    default_password: "changeme"
    
    # Password requirements
    password_policy:
      min_length: 8
      require_uppercase: true
      require_lowercase: true
      require_numbers: true
      require_special: false
    
    # Session settings
    session_lifetime: 86400  # 24 hours
    max_sessions_per_user: 5
    
  # Access control
  access_control:
    # Allowed IP ranges for admin access
    admin_allow_from:
      - "127.0.0.1/32"
      - "192.168.0.0/16"
      - "10.0.0.0/8"
      - "::1/128"
    
    # API access restrictions
    api_allow_from: []  # Empty = all allowed

# Performance Tuning
performance:
  # Worker processes (0 = auto-detect)
  workers: 0
  
  # Worker connections
  worker_connections: 1000
  
  # DNS packet queue size
  dns_queue_size: 1000
  
  # Garbage collection
  gc:
    enabled: true
    threshold: 1000

# Advanced Features
features:
  # Conditional forwarding
  conditional_forwarding:
    enabled: false
    domain: "local"
    target: "192.168.1.1"
    
  # DHCP server integration
  dhcp:
    enabled: false
    interface: "eth0"
    
  # IPv6 support
  ipv6:
    enabled: true
    block_mode: "null_ipv6"  # null_ipv6, nxdomain
    
  # DNS-over-HTTPS (DoH)
  doh:
    enabled: false
    port: 443
    path: "/dns-query"
    
  # DNS-over-TLS (DoT)
  dot:
    enabled: false
    port: 853
    
  # Response modification
  response_modification:
    # Minimum TTL for all responses
    min_ttl: 0
    # Force safe search
    force_safe_search: false

# Integrations
integrations:
  # Prometheus metrics export
  prometheus:
    enabled: false
    port: 9090
    path: "/metrics"
    
  # Syslog forwarding
  syslog:
    enabled: false
    server: "localhost"
    port: 514
    protocol: "udp"
    
  # Webhook notifications
  webhooks:
    enabled: false
    endpoints: []

# Maintenance
maintenance:
  # Automatic backups
  backup:
    enabled: true
    interval: 86400  # daily
    retain_days: 30
    path: "/var/lib/pidanos/backups"
    
  # Log rotation
  log_rotation:
    enabled: true
    max_size: "100M"
    max_files: 10
    compress: true